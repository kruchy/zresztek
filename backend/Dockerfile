FROM node:18-alpine

ARG RECIPE_PROMPT
ARG PORT
ARG OPENAI_API_KEY
ARG CONSTANT_INGREDIENTS
ARG SINGLE_VARYING_INGREDIENTS
ARG SINGLE_RECIPE_PROMPT

ENV CONSTANT_INGREDIENTS=${CONSTANT_INGREDIENTS}
ENV SINGLE_VARYING_INGREDIENTS=${SINGLE_VARYING_INGREDIENTS}
ENV SINGLE_RECIPE_PROMPT=${SINGLE_RECIPE_PROMPT}
ENV OPENAI_API_KEY=${OPENAI_API_KEY}
ENV PORT=${PORT}

ENV NODE_ENV=production

WORKDIR /app

COPY package*.json ./

RUN npm ci

COPY . .

RUN npm install -g pm2

EXPOSE 4000

CMD ["pm2-runtime", "server.js"]
